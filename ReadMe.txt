

こちらは一部の方しか見ないと思うので気楽に適当に行きます。


手持ちの1000番台でbmp保存のSSがクソ遅かったんで、
pngで撮れるプラグイン使おうと思ったら1000番台非対応…。
それを機に色々と探してみたのですが、
・1000〜3000番台対応
・CFW,LCFW,HENの5.00〜6.39対応
・bmp,png,jpeg対応
上記全てを満たすモノが見つからなかったので、
しょうがなく自作するかな、というのが事の発端。
でも完成後3000でbmp保存したらクソ早くって涙目。なんでこんなに違うんだろ。

pngとjpegのライブラリを使うために最初はlibpsplibcをUSE_PSPSDK_LIBCで指定してたんですが、
それだと6.36Pro(HEN)で動かなかったり、ヒープのメモリ足りなくてコケたりしたので、
結局
・pspsdkのソースからstdio.cとsetjmp.Sを持ってきて必要関数のみ指定してコンパイル
・malloc/freeは自前で実装
・その他要求される関数はダミーでガワだけ用意
という形に落ち着きました。

fwrite/fread辺りに関しては書き込み読み出しにコールバックを使えばいいんですが、
それでも要求されるんで面倒臭くなって

でもなぜか6.36Pro(HEN)だとpng保存で不正な画像形式になります。
エラーは出てないけど、出来たファイル見るとデータ化けまくってる。
ちゃんとワーニング処理すればなんとかなるのかもしれないけど、
こんな環境で常用する人もいないだろうってことで放置。
何か知っている方がいらっしゃったら連絡欲しいです。

それと6.36Pro(HEN)だと、pspsdkからsetjmp.Sを持ってこないと固まります。
コンパイルは通るんですけどね〜。
v01のリリース直前でコンパイル通るからって外したら固まるようになってました…。
リリース直前になにか変更を入れるってやっぱり良くないですな。

libini v1.3が無いとコンパイルできませんので、
makeしてみたい方は用意しておいてください。

ホント色々な方のソースやらなんやらを参考にさせて頂いています。
無償でフリーでソースを公開されている方には頭が上がりません。

そんなわけでライセンスについてですが、
参考ソースor使用ライブラリがGPLv2のため、これもGPLv2になる…ような。
んでも自分が書いてる部分に関しては好きなようにして頂いて構わないです。
その場合、参考した旨をちょこっと書いて頂けるか、
連絡先の方に一言あれば嬉しいな〜、というカンジです。


以上。

yakou
http://yakou-mh.seesaa.net/
mailto:yakou.mh@gmail.com
twitter @takeyakou
